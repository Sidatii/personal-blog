---
phase: 00-laravel-setup
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true
must_haves:
  truths:
    - "Laravel 11 is installed and accessible"
    - "PostgreSQL database is configured and connected"
    - "Composer and npm dependencies are installed"
    - "Application runs locally (php artisan serve)"
  artifacts:
    - path: "composer.json"
      provides: "Laravel dependencies"
    - path: "package.json"
      provides: "NPM dependencies (TailwindCSS, Vite)"
    - path: ".env"
      provides: "Database credentials and app configuration"
    - path: "bootstrap/app.php"
      provides: "Laravel bootstrap configuration"
    - path: "config/database.php"
      provides: "PostgreSQL connection settings"
    - path: "artisan"
      provides: "CLI tool for artisan commands"
    - path: "public/"
      provides: "Web root with index.php"
  key_links:
    - from: ".env"
      to: "config/database.php"
      via: "Environment variables"
      pattern: "DB_CONNECTION=pg.*DB_HOST.*DB_PORT"
---

<objective>
Install Laravel 11 project and configure PostgreSQL database connection.

Purpose: Establish the foundation framework. All subsequent phases depend on having Laravel installed with working database connection.

Output: Running Laravel application with PostgreSQL configured.
</objective>

<execution_context>
@/home/human/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/human/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/research/SUMMARY.md

# Stack Configuration (from Research)

**Required versions:**
- PHP 8.2+ (Laravel 11 requirement)
- Composer (PHP package manager)
- Node.js 18+ (for npm/TailwindCSS/Vite)
- PostgreSQL 10.0+ (database)

**Laravel 11 setup:**
- Minimal installer: `composer create-project laravel/laravel .`
- Or via installer: `laravel new .`
- No "application starter kit" â€” we'll build custom

**Dependencies to install:**
```bash
composer require league/commonmark spatie/yaml-front-matter
composer require --dev pestphp/pest
```

**Frontend:**
- TailwindCSS 4.x via Vite
- Alpine.js for interactivity (optional)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Laravel 11</name>
  <files>composer.json, artisan, bootstrap/app.php, public/index.php, routes/, app/Http/</files>
  <action>
    **IMPORTANT:** Backup any existing files first (though this is a fresh project).

    **Install Laravel 11 via Composer:**

    ```bash
    # Option A: Fresh install (recommended)
    composer create-project laravel/laravel .

    # Option B: Via Laravel installer (if available)
    # laravel new .

    # This creates:
    # - composer.json (Laravel dependencies)
    # - artisan (CLI)
    # - bootstrap/app.php (application bootstrap)
    # - public/index.php (web entry point)
    # - routes/web.php, api.php, console.php, channels.php
    # - app/Http/ (controllers, middleware)
    # - app/Providers/ (service providers)
    # - config/ (configuration files)
    # - storage/ (logs, cache, sessions)
    # - database/ (migrations, factories, seeders)
    ```

    **Verify installation:**
    ```bash
    php artisan --version  # Should show Laravel 11.x
    php artisan list         # Should show available commands
    ```

    **If installation fails:**
    - Check PHP version: `php -v` (must be 8.2+)
    - Check Composer: `composer --version`
    - Clear any existing files first
  </action>
  <verify>
    Run Laravel installation verification:
    ```bash
    php artisan --version  # Laravel 11.x
    php artisan list        # 100+ commands listed
    ls -la artisan         # File exists and executable
    ```
  </verify>
  <done>
    Laravel 11 installed successfully with artisan CLI working
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure PostgreSQL connection</name>
  <files>.env, config/database.php</files>
  <action>
    **Create/update .env file** with PostgreSQL settings:

    ```bash
    # Copy example env if needed
    cp .env.example .env 2>/dev/null || echo "Creating .env..."

    # Update .env with PostgreSQL settings:
    ```

    ```env
    APP_NAME=PersonalBlog
    APP_ENV=local
    APP_KEY=base64:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
    APP_DEBUG=true
    APP_URL=http://localhost:8000

    DB_CONNECTION=pgsql
    DB_HOST=127.0.0.1
    DB_PORT=5432
    DB_DATABASE=personal_blog
    DB_USERNAME=postgres
    DB_PASSWORD=your_password

    CACHE_DRIVER=file
    SESSION_DRIVER=file
    QUEUE_DRIVER=sync
    ```

    **Generate app key:**
    ```bash
    php artisan key:generate
    ```

    **Configure config/database.php** (usually works with .env, but verify):

    ```php
    'default' => env('DB_CONNECTION', 'pgsql'),

    'connections' => [
        'pgsql' => [
            'driver' => 'pgsql',
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '5432'),
            'database' => env('DB_DATABASE', 'personal_blog'),
            'username' => env('DB_USERNAME', 'postgres'),
            'password' => env('DB_PASSWORD', ''),
            'charset' => 'utf8',
            'prefix' => '',
            'prefix_indexes' => true,
            'search_path' => 'public',
        ],
    ],
    ```

    **Create database in PostgreSQL:**
    ```bash
    # Connect to PostgreSQL
    psql -U postgres

    # Create database
    CREATE DATABASE personal_blog;

    # Exit
    \q
    ```
  </action>
  <verify>
    Test database connection:
    ```bash
    php artisan tinker --execute="echo \DB::connection()->getDatabaseName();"
    # Should output: personal_blog

    php artisan migrate:fresh --dry-run
    # Should show migrations that would run, no errors
    ```
  </verify>
  <done>
    PostgreSQL database connection configured and tested successfully
  </done>
</task>

<task type="auto">
  <name>Task 3: Install additional dependencies</name>
  <files>composer.json, vendor/, package.json, node_modules/</files>
  <action>
    **Install markdown processing and frontmatter packages:**

    ```bash
    # Markdown parsing
    composer require league/commonmark

    # YAML frontmatter parsing
    composer require spatie/yaml-front-matter

    # Development testing framework
    composer require --dev pestphp/pest
    ```

    **Install frontend dependencies:**

    ```bash
    # Laravel includes Vite + TailwindCSS by default
    npm install

    # Verify TailwindCSS is configured
    npm list tailwindcss
    ```

    **Verify in composer.json:**
    ```json
    "require": {
        "php": "^8.2",
        "laravel/framework": "^11.0",
        "league/commonmark": "^2.8",
        "spatie/yaml-front-matter": "^2.0"
    }
    ```
  </action>
  <verify>
    Verify dependencies installed:
    ```bash
    composer show league/commonmark
    composer show spatie/yaml-front-matter
    ls -la vendor/ | head -20  # Vendor directory exists
    npm list tailwindcss
    ```
  </verify>
  <done>
    All required dependencies installed (markdown, frontmatter, testing)
  </done>
</task>

<task type="auto">
  <name>Task 4: Verify application runs</name>
  <files>artisan, bootstrap/app.php, routes/web.php</files>
  <action>
    **Test Laravel serving:**

    ```bash
    # Option A: Development server (keep running)
    php artisan serve
    # Open http://localhost:8000 in browser

    # Option B: Quick test (one command)
    php artisan tinker --execute="echo 'Laravel is working!';"
    ```

    **Verify routes are loaded:**
    ```bash
    php artisan route:list
    # Should show web routes (at minimum: /, /login, etc.)
    ```

    **Test database connection with migration:**
    ```bash
    php artisan migrate:fresh
    # Should create: users, password_reset_tokens, personal_access_tokens, migrations tables
    ```

    **Check environment:**
    ```bash
    php artisan env
    # Should show APP_ENV=local, APP_DEBUG=true
    ```
  </action>
  <verify>
    Final verification:
    ```bash
    # 1. Laravel responds
    curl http://localhost:8000/ 2>/dev/null | head -20
    # Should show HTML output

    # 2. Artisan works
    php artisan --version  # Laravel 11.x

    # 3. Database connected
    php artisan tinker --execute="echo \DB::connection()->getDatabaseName();"

    # 4. Routes working
    php artisan route:list | head -10
    ```
  </verify>
  <done>
    Laravel application runs successfully with PostgreSQL connected
  </done>
</task>

</tasks>

<verification>
## Phase 0 Verification Checklist

Run these commands to verify Phase 0 completion:

```bash
# 1. Laravel installation
php artisan --version
# Expected: Laravel 11.x

# 2. Database connection
php artisan tinker --execute="echo 'Database: ' . \DB::connection()->getDatabaseName();"
# Expected: Database: personal_blog

# 3. Dependencies installed
composer show league/commonmark
composer show spatie/yaml-front-matter
# Expected: Package information displayed

# 4. Application runs
php artisan serve &
sleep 2
curl http://localhost:8000/ | head -5
kill %1 2>/dev/null
# Expected: HTML output from Laravel welcome page

# 5. Migration works
php artisan migrate:fresh
# Expected: Tables created without errors
```

**Quick test command:**
```bash
php artisan tinker --execute='echo "Laravel: " . \Illuminate\Support\Lottery::winners(1)->once(function () { return \Illuminate\Support\Facades\Artisan::call("--version"); }) . PHP_EOL . "DB: " . \DB::connection()->getDatabaseName() . PHP_EOL . "CommonMark: " . (class_exists(\League\CommonMark\CommonMarkConverter::class) ? "Installed" : "Missing");'
```

Expected output:
```
Laravel: Laravel 11.x
DB: personal_blog
CommonMark: Installed
```
</verification>

<success_criteria>
## Phase 0 Success Criteria

**Functional:**
- [ ] `php artisan --version` shows Laravel 11.x
- [ ] `php artisan migrate:fresh` creates tables without errors
- [ ] `composer show league/commonmark` displays package info
- [ ] Application serves at http://localhost:8000/
- [ ] Routes load (`php artisan route:list`)

**Quality:**
- [ ] PostgreSQL configured as default database
- [ ] .env file created with secure APP_KEY
- [ ] Dependencies committed to composer.lock
- [ ] Project ready for application development
</success_criteria>

<output>
After completion, create `.planning/phases/00-laravel-setup/00-01-SUMMARY.md`
</output>
