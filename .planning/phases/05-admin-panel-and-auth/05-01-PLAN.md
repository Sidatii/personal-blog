---
phase: 05-admin-panel-and-auth
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/Models/Admin.php
  - app/Http/Controllers/Admin/Auth/LoginController.php
  - app/Http/Controllers/Admin/Auth/LogoutController.php
  - app/Http/Middleware/AdminAuth.php
  - database/migrations/2026_02_08_000000_create_admins_table.php
  - database/seeders/AdminSeeder.php
  - resources/views/admin/auth/login.blade.php
  - routes/admin.php
autonomous: true

must_haves:
  truths:
    - "Admin can log in via /admin/login with email and password"
    - "Admin session persists across requests"
    - "Unauthenticated users are redirected to login"
    - "Logout clears session and redirects to login"
    - "Default admin user exists after seeding"
  artifacts:
    - path: "app/Models/Admin.php"
      provides: "Admin user model with auth support"
      exports: ["Admin"]
    - path: "app/Http/Controllers/Admin/Auth/LoginController.php"
      provides: "Login form display and authentication"
      exports: ["show", "login"]
    - path: "app/Http/Middleware/AdminAuth.php"
      provides: "Authentication middleware for admin routes"
      exports: ["handle"]
    - path: "routes/admin.php"
      provides: "Admin route definitions"
      contains: "Route::group.*middleware.*admin"
  key_links:
    - from: "routes/admin.php"
      to: "app/Http/Middleware/AdminAuth.php"
      via: "route middleware"
      pattern: "middleware.*admin"
    - from: "app/Http/Controllers/Admin/Auth/LoginController.php"
      to: "app/Models/Admin.php"
      via: "Auth::guard('admin')"
      pattern: "Auth::guard.*admin"
---

<objective>
Implement admin authentication system with secure login, logout, and session management using Laravel's built-in auth (not Breeze) for minimal footprint.

Purpose: Enable secure admin access to the backend without adding heavy dependencies like Breeze or Jetstream. Uses Laravel's native auth guards and sessions.

Output: Admin model, authentication controllers, middleware, login view, and admin routes file.
</objective>

<execution_context>
@/home/human/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/human/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-admin-panel-and-auth/05-RESEARCH.md
@.planning/STATE.md

@app/Models/User.php
@routes/web.php
@resources/views/layouts/app.blade.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Admin model, migration, and seeder</name>
  <files>
    app/Models/Admin.php
    database/migrations/2026_02_08_000000_create_admins_table.php
    database/seeders/AdminSeeder.php
  </files>
  <action>
    Create app/Models/Admin.php:
    - Extend Illuminate\Foundation\Auth\User
    - Use Illuminate\Notifications\Notifiable, Illuminate\Database\Eloquent\Factories\HasFactory
    - $fillable: ['name', 'email', 'password']
    - $hidden: ['password', 'remember_token']
    - $casts: ['password' => 'hashed']

    Create migration with columns:
    - id (bigIncrements)
    - name (string)
    - email (string, unique, indexed)
    - email_verified_at (timestamp, nullable)
    - password (string)
    - remember_token (string, nullable)
    - timestamps()

    Create AdminSeeder:
    - Create single admin: name='Admin', email='admin@example.com', password='password' (bcrypt)
    - Use Hash::make() for password
  </action>
  <verify>
    Run `php artisan migrate` successfully
    Run `php artisan db:seed --class=AdminSeeder` successfully
    Run `php artisan tinker --execute="\App\Models\Admin::first()->email"` returns admin@example.com
  </verify>
  <done>
    Admin model exists with auth support, migration creates table, seeder creates default admin
  </done>
</task>

<task type="auto">
  <name>Task 2: Create admin auth controllers and middleware</name>
  <files>
    app/Http/Controllers/Admin/Auth/LoginController.php
    app/Http/Controllers/Admin/Auth/LogoutController.php
    app/Http/Middleware/AdminAuth.php
    app/Http/Middleware/RedirectIfNotAdmin.php
  </files>
  <action>
    Create LoginController:
    - show(): Return login view
    - login(Request $request): Validate email/password, Auth::guard('admin')->attempt(), redirect to dashboard
    - Validation: email (required, email), password (required)
    - Error message: 'Invalid credentials' on failure

    Create LogoutController:
    - logout(): Auth::guard('admin')->logout(), invalidate session, regenerate token, redirect to login

    Create AdminAuth middleware:
    - handle($request, $next): Check Auth::guard('admin')->check(), if not redirect to admin.login

    Create RedirectIfNotAdmin middleware (alternative approach):
    - Similar to AdminAuth but use config for redirect path

    Note: Use Auth::guard('admin') explicitly for all auth operations
  </action>
  <verify>
    Classes load without errors: `php -l app/Http/Controllers/Admin/Auth/LoginController.php`
    Middleware registered check: `php artisan route:list --path=admin`
  </verify>
  <done>
    Controllers handle login/logout with admin guard, middleware protects admin routes
  </done>
</task>

<task type="auto">
  <name>Task 3: Create login view and admin routes</name>
  <files>
    resources/views/admin/auth/login.blade.php
    routes/admin.php
    config/auth.php (modify)
  </files>
  <action>
    Update config/auth.php:
    - Add 'admin' guard using 'session' driver, 'admins' provider
    - Add 'admins' provider using 'eloquent' driver, model: App\Models\Admin::class

    Create routes/admin.php:
    - Route::get('/login', [LoginController::class, 'show'])->name('admin.login')->middleware('guest:admin')
    - Route::post('/login', [LoginController::class, 'login'])->name('admin.login.post')->middleware('guest:admin')
    - Route::post('/logout', [LogoutController::class, 'logout'])->name('admin.logout')->middleware('admin')
    - Route::get('/', fn() => 'Admin Dashboard')->name('admin.dashboard')->middleware('admin')

    Create resources/views/admin/auth/login.blade.php:
    - Simple login form without extending main layout (clean, focused)
    - Email and password fields
    - CSRF token
    - Error display
    - Rose Pine dark theme styling (bg-rose-pine-base, text-rose-pine-text)
    - Centered card layout

    Register routes in RouteServiceProvider or bootstrap/app.php:
    - Route::middleware('web')->group(base_path('routes/admin.php'))
  </action>
  <verify>
    Run `php artisan route:list --path=admin` shows login, logout, dashboard routes
    Visit /admin/login shows login form
    Submit with wrong credentials shows error
    Submit with admin@example.com / password redirects to /admin
  </verify>
  <done>
    Login form works, routes registered, auth guard configured, middleware functional
  </done>
</task>

</tasks>

<verification>
- `php artisan route:list --path=admin` shows 4 routes
- /admin/login displays form with Rose Pine dark styling
- Login with correct credentials authenticates and redirects
- Login with wrong credentials shows error
- /admin accessible only when logged in
- /admin redirects to login when not authenticated
</verification>

<success_criteria>
- Admin can log in at /admin/login with admin@example.com / password
- Auth persists across page loads
- Logout clears session
- Admin guard separate from default user guard
- All admin routes protected by middleware
</success_criteria>

<output>
After completion, create `.planning/phases/05-admin-panel-and-auth/05-01-SUMMARY.md`
</output>
