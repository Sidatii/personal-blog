---
phase: 03-blog-features-and-seo
plan: "02"
type: execute
wave: 1
depends_on: ["03-01"]
files_modified:
  - resources/views/layouts/app.blade.php
  - resources/views/components/header.blade.php
  - resources/views/components/footer.blade.php
  - resources/views/components/dark-mode-toggle.blade.php
  - routes/api.php
autonomous: true

must_haves:
  truths:
    - "Dark mode toggle button appears in header with sun/moon icons"
    - "Clicking toggle switches between Rose Pine (dark) and Rose Pine Dawn (light)"
    - "Header shows logo, navigation links, and dark mode toggle"
    - "Footer shows copyright, social links, and navigation links"
    - "Base layout includes header, content slot, and footer"
  artifacts:
    - path: "resources/views/layouts/app.blade.php"
      provides: "Base layout with dark mode script and component includes"
      min_lines: 25
    - path: "resources/views/components/header.blade.php"
      provides: "Header with logo, nav, dark mode toggle, mobile hamburger"
      min_lines: 20
    - path: "resources/views/components/footer.blade.php"
      provides: "Footer with copyright, social icons, and links"
      min_lines: 15
    - path: "resources/views/components/dark-mode-toggle.blade.php"
      provides: "Dark mode toggle with sun/moon icons and cookie persistence"
      min_lines: 30
  key_links:
    - from: "resources/views/layouts/app.blade.php"
      to: "resources/js/dark-mode.js"
      via: "Script include in head"
      pattern: "dark-mode.js"
    - from: "resources/views/layouts/app.blade.php"
      to: "resources/views/components/header.blade.php"
      via: "@include directive"
      pattern: "@include.*header"
    - from: "resources/views/layouts/app.blade.php"
      to: "resources/views/components/footer.blade.php"
      via: "@include directive"
      pattern: "@include.*footer"
    - from: "resources/views/components/dark-mode-toggle.blade.php"
      to: "window.darkMode.toggle()"
      via: "JavaScript call"
      pattern: "window.darkMode.toggle"
    - from: "resources/views/components/dark-mode-toggle.blade.php"
      to: "POST /api/theme/toggle"
      via: "fetch() call to endpoint"
      pattern: "fetch.*theme.*toggle"
    - from: "resources/views/components/header.blade.php"
      to: "resources/views/components/dark-mode-toggle.blade.php"
      via: "@include directive"
      pattern: "@include.*dark-mode-toggle"
---

<objective>
Create header component with logo, navigation, and dark mode toggle. Create footer component with copyright, social links, and navigation. Create dark mode toggle component. Assemble base layout with all components.

Purpose: Core UI components. Header provides navigation and theme toggle. Footer provides site navigation. Layout ties everything together.

Output: Working header, footer, dark mode toggle, and base layout.
</objective>

<execution_context>
@/home/human/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/human/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-blog-features-and-seo/03-CONTEXT.md
@.planning/phases/03-blog-features-and-seo/03-RESEARCH.md
@.planning/phases/03-blog-features-and-seo/03-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dark mode toggle endpoint</name>
  <files>
    routes/api.php
    app/Http/Controllers/ThemeController.php
  </files>
  <action>
    Create `app/Http/Controllers/ThemeController.php`:

    ```php
    <?php
    
    namespace App\Http\Controllers;
    
    use Illuminate\Http\Request;
    use Illuminate\Http\Response;
    
    class ThemeController extends Controller
    {
        public function toggle(Request $request): Response
        {
            $request->validate([
                'theme' => 'required|in:dark,light'
            ]);
            
            $theme = $request->theme;
            $minutes = 30 * 24 * 60; // 30 days
            
            $response = response()->json(['theme' => $theme]);
            $response->withCookie(cookie('theme', $theme, $minutes, path: '/', sameSite: 'lax'));
            
            return $response;
        }
    }
    ```

    Add to `routes/api.php`:

    ```php
    Route::post('/theme/toggle', [ThemeController::class, 'toggle'])->name('theme.toggle');
    ```

    **Key link:** This endpoint is called by the dark-mode-toggle component via `fetch('/api/theme/toggle', ...)`.
  </action>
  <verify>
`grep -c "route.*theme.toggle" routes/api.php` returns >= 1
`ls -la app/Http/Controllers/ThemeController.php` exists
`grep -c "cookie.*theme" app/Http/Controllers/ThemeController.php` returns >= 1
  </verify>
  <done>Theme toggle endpoint created. Accepts POST with theme, sets cookie, returns JSON.</done>
</task>

<task type="auto">
  <name>Task 2: Create dark mode toggle component</name>
  <files>
    resources/views/components/dark-mode-toggle.blade.php
  </files>
  <action>
    Create `resources/views/components/dark-mode-toggle.blade.php`:

    1. **Button element:**
       - `class="p-2 rounded-lg hover:bg-rose-pine-overlay transition-colors"`
       - `aria-label="Toggle dark mode"`
       - `x-data` to sync with current theme state
       - `@click` to call toggle function

    2. **Sun icon** (visible when in dark mode, to switch to light):
       ```blade
       <svg x-show="isDark" class="w-5 h-5 text-rose-pine-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
       </svg>
       ```

    3. **Moon icon** (visible when in light mode, to switch to dark):
       ```blade
       <svg x-show="!isDark" class="w-5 h-5 text-rose-pine-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
       </svg>
       ```

    4. **Alpine.js logic with endpoint call:**
       ```blade
       x-data="{ 
           isDark: document.documentElement.classList.contains('dark') || window.darkMode.getTheme() === 'dark'
       }"
       @click="
           isDark = !isDark;
           fetch('/api/theme/toggle', {
               method: 'POST',
               headers: { 'Content-Type': 'application/json', 'X-CSRF-TOKEN': '{{ csrf_token() }}' },
               body: JSON.stringify({ theme: isDark ? 'dark' : 'light' })
           }).then(() => window.darkMode.toggle());
       "
       ```

    **Key link:** Calls `fetch('/api/theme/toggle', ...)` to set cookie server-side, then updates client-side state.
  </action>
  <verify>
`grep -c "fetch.*theme.*toggle" resources/views/components/dark-mode-toggle.blade.php` returns >= 1
`grep -c "x-show.*isDark" resources/views/components/dark-mode-toggle.blade.php` returns >= 2
`grep -c "rose-pine-gold" resources/views/components/dark-mode-toggle.blade.php` returns >= 1
  </verify>
  <done>Toggle button renders with sun/moon icons. Clicking calls POST /api/theme/toggle and updates state.</done>
</task>

<task type="auto">
  <name>Task 3: Create header component</name>
  <files>
    resources/views/components/header.blade.php
  </files>
  <action>
    Create `resources/views/components/header.blade.php`:

    1. **Header element:**
       ```blade
       <header class="sticky top-0 z-50 bg-rose-pine-base/80 backdrop-blur-md border-b border-rose-pine-overlay">
           <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
       ```

    2. **Flex container:**
       ```blade
       <div class="flex items-center justify-between h-16">
       ```

    3. **Logo/brand (left):**
       ```blade
       <a href="/" class="text-xl font-bold text-rose-pine-text hover:text-rose-pine-rose transition-colors">
           {{ config('app.name') }}
       </a>
       ```

    4. **Navigation links (center/right):**
       ```blade
       <nav class="hidden md:flex items-center space-x-8">
           <a href="/blog" class="text-rose-pine-subtle hover:text-rose-pine-text transition-colors">Blog</a>
           <a href="/about" class="text-rose-pine-subtle hover:text-rose-pine-text transition-colors">About</a>
           @include('components.dark-mode-toggle')
       </nav>
       ```

    5. **Mobile hamburger button:**
       ```blade
       <button x-data="{ open: false }" @click="open = !open" class="md:hidden p-2 text-rose-pine-subtle">
           <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
               <path x-show="!open" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
               <path x-show="open" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
           </svg>
       </button>
       ```

    6. **Mobile menu dropdown:**
       ```blade
       <div x-show="open" x-transition @click.away="open = false" class="md:hidden absolute top-16 left-0 right-0 bg-rose-pine-base border-b border-rose-pine-overlay p-4 space-y-4">
           <a href="/blog" class="block text-rose-pine-subtle hover:text-rose-pine-text">Blog</a>
           <a href="/about" class="block text-rose-pine-subtle hover:text-rose-pine-text">About</a>
           <div class="pt-2">@include('components.dark-mode-toggle')</div>
       </div>
       ```
  </action>
  <verify>
`grep -c 'sticky top-0' resources/views/components/header.blade.php` returns 1
`grep -c '@include.*dark-mode-toggle' resources/views/components/header.blade.php` returns >= 1
`grep -c 'md:hidden' resources/views/components/header.blade.php` returns >= 1
  </verify>
  <done>Header renders with logo, nav links, dark mode toggle, and mobile hamburger menu with dropdown.</done>
</task>

<task type="auto">
  <name>Task 4: Create footer component</name>
  <files>
    resources/views/components/footer.blade.php
  </files>
  <action>
    Create `resources/views/components/footer.blade.php`:

    1. **Footer element:**
       ```blade
       <footer class="mt-auto py-8 border-t border-rose-pine-overlay bg-rose-pine-surface">
           <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
       ```

    2. **Flex container:**
       ```blade
       <div class="flex flex-col md:flex-row items-center justify-between gap-4">
       ```

    3. **Copyright:**
       ```blade
       <p class="text-sm text-rose-pine-muted">
           &copy; {{ date('Y') }} {{ config('app.name') }}. All rights reserved.
       </p>
       ```

    4. **Navigation links:**
       ```blade
       <nav class="flex items-center space-x-6 text-sm">
           <a href="/blog" class="text-rose-pine-subtle hover:text-rose-pine-text transition-colors">Blog</a>
           <a href="/about" class="text-rose-pine-subtle hover:text-rose-pine-text transition-colors">About</a>
           <a href="/feed" class="text-rose-pine-subtle hover:text-rose-pine-text transition-colors">RSS</a>
       </nav>
       ```

    5. **Social icons:**
       ```blade
       <div class="flex items-center space-x-4">
           <a href="https://github.com/yourusername" target="_blank" rel="noopener" class="text-rose-pine-subtle hover:text-rose-pine-text">
               <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
           </a>
       </div>
       ```
  </action>
  <verify>
`grep -c 'mt-auto' resources/views/components/footer.blade.php` returns 1
`grep -c 'border-t.*rose-pine-overlay' resources/views/components/footer.blade.php` returns 1
`grep -c 'flex.*flex-row' resources/views/components/footer.blade.php` returns >= 1
  </verify>
  <done>Footer renders with copyright, navigation links, and social icons in responsive layout.</done>
</task>

<task type="auto">
  <name>Task 5: Create base layout</name>
  <files>
    resources/views/layouts/app.blade.php
  </files>
  <action>
    Create `resources/views/layouts/app.blade.php`:

    1. **HTML tag with dark mode class:**
       ```blade
       <!DOCTYPE html>
       <html lang="en" class="{{ cookie('theme', 'dark') === 'dark' ? 'dark' : '' }}">
       ```

    2. **Head section:**
       ```blade
       <head>
           <meta charset="UTF-8">
           <meta name="viewport" content="width=device-width, initial-scale=1.0">
           <meta name="csrf-token" content="{{ csrf_token() }}">
           
           <title>{{ $title ?? config('app.name') }}</title>
           
           {{-- Dark mode script (blocking to prevent FOUC) --}}
           <script src="{{ asset('js/dark-mode.js') }}"></script>
           
           {{-- Vite CSS --}}
           @vite(['resources/css/app.css'])
       </head>
       ```

    3. **Body with Rose Pine classes:**
       ```blade
       <body class="bg-rose-pine-base text-rose-pine-text antialiased min-h-screen flex flex-col">
       ```

    4. **Header include:**
       ```blade
           @include('components.header')
       ```

    5. **Main content slot:**
       ```blade
           <main class="flex-grow">
               @yield('content')
           </main>
       ```

    6. **Footer include:**
       ```blade
           @include('components.footer')
       ```

    7. **Scripts stack:**
       ```blade
           @stack('scripts')
           
           {{-- Vite JS --}}
           @vite(['resources/js/app.js'])
       </body>
       </html>
       ```

    **Important:** dark-mode.js script must be included BEFORE stylesheet to prevent flash of incorrect theme.
  </action>
  <verify>
`grep -c "class.*dark.*dark" resources/views/layouts/app.blade.php` returns 1
`grep -c 'dark-mode.js' resources/views/layouts/app.blade.php` returns >= 1
`grep -c '@include.*header' resources/views/layouts/app.blade.php` returns >= 1
`grep -c '@include.*footer' resources/views/layouts/app.blade.php` returns >= 1
  </verify>
  <done>Base layout with dark mode initialization, header, content slot, and footer. Rose Pine classes applied.</done>
</task>

</tasks>

<verification>
- Dark mode toggle appears in header with working sun/moon icons
- Clicking toggle switches between Rose Pine and Rose Pine Dawn
- Header shows logo, nav links, and mobile hamburger
- Footer shows copyright, links, and social icons
- Layout includes dark-mode.js before styles to prevent FOUC
</verification>

<success_criteria>
- Visit any page, header shows all elements correctly
- Dark mode toggle visible and functional
- Theme persists when toggling and refreshing
- Mobile hamburger works on small screens
- Footer at bottom with all elements
</success_criteria>

<output>
After completion, create `.planning/phases/03-blog-features-and-seo/03-02-SUMMARY.md`
