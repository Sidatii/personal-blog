---
phase: 03-blog-features-and-seo
plan: "06"
type: execute
wave: 3
depends_on: ["03-02", "03-04"]
files_modified:
  - composer.json
  - app/Models/Post.php
  - config/feed.php
  - routes/web.php
  - resources/views/feed.blade.php
  - app/Console/Commands/GenerateSitemap.php
autonomous: true

must_haves:
  truths:
    - "RSS/Atom feed accessible at /feed"
    - "Feed includes latest posts with proper formatting"
    - "XML sitemap accessible at /sitemap.xml"
    - "Sitemap includes all published posts"
  artifacts:
    - path: "app/Models/Post.php"
      provides: "Post model with Feedable and Sitemapable interfaces"
      min_lines: 25
    - path: "config/feed.php"
      provides: "Feed configuration with main feed settings"
      min_lines: 20
    - path: "routes/web.php"
      provides: "Feed route registration"
      min_lines: 10
    - path: "app/Console/Commands/GenerateSitemap.php"
      provides: "Sitemap generation command"
      min_lines: 30
  key_links:
    - from: "app/Models/Post.php"
      to: "spatie/laravel-feed"
      via: "Feedable interface and toFeedItem method"
      pattern: "Feedable|toFeedItem"
    - from: "routes/web.php"
      to: "spatie/laravel-feed"
      via: "Route::feeds()"
      pattern: "Route::feeds"
    - from: "app/Console/Commands/GenerateSitemap.php"
      to: "spatie/laravel-sitemap"
      via: "Sitemap::create()"
      pattern: "Sitemap::create"
---

<objective>
Implement RSS/Atom feed and XML sitemap for blog posts using spatie/laravel-feed and spatie/laravel-sitemap packages.

Purpose: Enable feed readers to subscribe to blog and provide search engine discovery via sitemap.

Output: Working RSS/Atom feed and XML sitemap for the blog.
</objective>

<execution_context>
@/home/human/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/human/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-blog-features-and-seo/03-CONTEXT.md
@.planning/phases/03-blog-features-and-seo/03-RESEARCH.md
@.planning/phases/03-blog-features-and-seo/03-01-SUMMARY.md
@.planning/phases/03-blog-features-and-seo/03-02-SUMMARY.md
@.planning/phases/03-blog-features-and-seo/03-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Install spatie/laravel-feed and spatie/laravel-sitemap</name>
  <files>composer.json, config/feed.php</files>
  <action>
    Run `composer require spatie/laravel-feed` and `composer require spatie/laravel-sitemap`.

    Publish feed configuration:
    `php artisan vendor:publish --provider="Spatie\\Feed\\FeedServiceProvider"`

    Create `config/feed.php` with main feed settings:
    - Feed name: "My Blog"
    - Description: "Latest posts from my blog"
    - Language: en-US
    - Format: atom (or rss)
    - Feed URL: /feed
    - View: feed (the template)

    Reference: Use pattern from RESEARCH.md Pattern 7.
  </action>
  <verify>`composer show spatie/laravel-feed spatie/laravel-sitemap` confirms installation, `cat config/feed.php` shows configuration</verify>
  <done>Both packages installed and feed configuration created</done>
</task>

<task type="auto">
  <name>Update Post model to implement Feedable interface</name>
  <files>app/Models/Post.php</files>
  <action>
    Update `app/Models/Post.php`:
    - Implement `Spatie\Feed\Feedable` interface
    - Add `toFeedItem()` method returning FeedItem with:
      - id: post ID or slug
      - title: post title
      - summary: post excerpt or truncated content
      - updated: updated_at timestamp
      - link: URL to post (route('posts.show', $this))
      - authorName: author name
      - authorEmail: author email
    - Add static `getFeedItems()` method returning published posts, limited to 50, ordered by latest

    Reference: Use pattern from RESEARCH.md Pattern 7.
  </action>
  <verify>`cat app/Models/Post.php` shows Feedable interface and toFeedItem method</verify>
  <done>Post model can generate feed items for the RSS/Atom feed</done>
</task>

<task type="auto">
  <name>Create feed template and register feed route</name>
  <files>resources/views/feed.blade.php, routes/web.php</files>
  <action>
    Create `resources/views/feed.blade.php`:
    - Loop through feed items
    - Render title, summary, link, date, author
    - Use proper Atom/RSS XML formatting
    - Include full content or summary as configured

    Add feed route to `routes/web.php`:
    ```php
    use Illuminate\Support\Facades\Route;
    Route::feeds();
    ```

    This registers /feed, /feed.rss, /feed.atom routes automatically.
  </action>
  <verify>`cat routes/web.php` shows Route::feeds(), `cat resources/views/feed.blade.php` shows template</verify>
  <done>Feed accessible at /feed with proper Atom/RSS format</done>
</task>

<task type="auto">
  <name>Create sitemap generation command</name>
  <files>app/Console/Commands/GenerateSitemap.php, config/sitemap.php</files>
  <action>
    Create `app/Console/Commands/GenerateSitemap.php`:
    - Command: `php artisan sitemap:generate`
    - Create sitemap with:
      - Homepage URL with daily change frequency
      - Blog index with weekly change frequency
      - Individual posts with weekly change frequency, priority based on recency
    - Use Post::published()->get() for all posts
    - Write sitemap to public/sitemap.xml
    - Set proper last modification dates from posts

    Add route for sitemap.xml that returns the generated file or generates on demand.

    Reference: Use pattern from RESEARCH.md Pattern 8.
  </action>
  <verify>`cat app/Console/Commands/GenerateSitemap.php` shows sitemap generation command</verify>
  <done>Sitemap command creates XML sitemap with all published posts</done>
</task>

<task type="auto">
  <name>Register sitemap route and test feed/sitemap</name>
  <files>routes/web.php</files>
  <action>
    Add sitemap route to `routes/web.php`:
    ```php
    Route::get('/sitemap.xml', function () {
        // Either serve static file or generate dynamically
        return response(
            \Sitemap::create()
                ->add(\Sitemap\Tags\Url::create('/')->setLastModificationDate(now()))
                ->add(\Sitemap\Tags\Url::create('/blog')->setLastModificationDate(now()))
                ->add(Post::published()->get())
                ->toXml()
        )->header('Content-Type', 'application/xml');
    });
    ```

    Or if generating static file, serve from public_path('sitemap.xml').

    Test both endpoints:
    - Visit /feed in browser, verify Atom/RSS output
    - Visit /sitemap.xml, verify XML with all post URLs
  </action>
  <verify>`cat routes/web.php` shows sitemap route, curl /feed and /sitemap.xml return proper XML</verify>
  <done>Both /feed and /sitemap.xml return valid XML with blog content</done>
</task>

</tasks>

<verification>
- Visit /feed in browser, verify valid Atom/RSS feed format
- Check feed includes latest posts with proper dates and links
- Visit /sitemap.xml, verify XML sitemap with all URLs
- Validate XML against sitemap protocol (no errors)
- Test feed validation with online RSS validator
- Check that static or dynamic sitemap includes all published posts
</verification>

<success_criteria>
- RSS/Atom feed accessible and returns valid XML
- Feed includes all published posts with proper metadata
- XML sitemap accessible and includes all posts
- Both endpoints validate correctly
- Feed reader can subscribe to blog
</success_criteria>

<output>
After completion, create `.planning/phases/03-blog-features-and-seo/03-05-SUMMARY.md`
</output>
