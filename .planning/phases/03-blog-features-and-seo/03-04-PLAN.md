---
phase: 03-blog-features-and-seo
plan: "04"
type: execute
wave: 2
depends_on: ["03-01", "03-02", "03-03"]
files_modified:
  - resources/views/posts/show.blade.php
  - resources/views/components/table-of-contents.blade.php
  - resources/views/components/reading-progress.blade.php
  - resources/views/components/code-block.blade.php
autonomous: true

must_haves:
  truths:
    - "Single post view renders markdown content with syntax highlighting"
    - "Sticky table of contents on left side of post"
    - "Reading progress bar at top of post"
    - "Code blocks have line numbers and copy button"
  artifacts:
    - path: "resources/views/posts/show.blade.php"
      provides: "Single post view with TOC and progress bar integration"
      min_lines: 35
    - path: "resources/views/components/table-of-contents.blade.php"
      provides: "Sticky TOC with smooth scroll to headings"
      min_lines: 20
    - path: "resources/views/components/reading-progress.blade.php"
      provides: "Top progress bar indicating reading position"
      min_lines: 20
    - path: "resources/views/components/code-block.blade.php"
      provides: "Code block wrapper with line numbers and copy button"
      min_lines: 25
  key_links:
    - from: "resources/views/posts/show.blade.php"
      to: "app/Services/ShikiHighlighter.php"
      via: "Markdown rendering with Shiki integration"
      pattern: "ShikiHighlighter"
    - from: "resources/views/posts/show.blade.php"
      to: "resources/views/components/table-of-contents.blade.php"
      via: "@include with headings data"
      pattern: "@include.*table-of-contents"
    - from: "resources/views/posts/show.blade.php"
      to: "resources/views/components/reading-progress.blade.php"
      via: "@include at top of content"
      pattern: "@include.*reading-progress"
---

<objective>
Create single blog post view with markdown content, Shiki syntax highlighting, sticky table of contents, reading progress bar, and enhanced code blocks.

Purpose: Provide rich reading experience with navigation aids and professional code presentation.

Output: Single post page with all reader-facing features working.
</objective>

<execution_context>
@/home/human/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/human/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-blog-features-and-seo/03-CONTEXT.md
@.planning/phases/03-blog-features-and-seo/03-RESEARCH.md
@.planning/phases/03-blog-features-and-seo/03-01-SUMMARY.md
@.planning/phases/03-blog-features-and-seo/03-02-SUMMARY.md
@.planning/phases/03-blog-features-and-seo/03-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reading progress bar component</name>
  <files>
    resources/views/components/reading-progress.blade.php
  </files>
  <action>
    Create `resources/views/components/reading-progress.blade.php`:

    1. Root `<div>`:
       ```blade
       <div x-data="{ progress: 0 }" x-init="calculate()" @scroll.window="calculate()"
            class="fixed top-0 left-0 w-full h-1 z-50">
       ```

    2. Progress calculation:
       ```javascript
       function calculate() {
           const scrollTop = window.scrollY;
           const docHeight = document.documentElement.scrollHeight - window.innerHeight;
           this.progress = Math.min(100, Math.max(0, (scrollTop / docHeight) * 100));
       }
       ```

    3. Progress bar:
       ```blade
       <div class="h-full bg-rose-pine-pine transition-all duration-150"
            :style="`width: ${progress}%`"></div>
       ```

    4. Background bar:
       ```blade
       <div class="w-full h-full bg-rose-pine-surface"></div>
       ```
  </action>
  <verify>
`grep -c 'fixed top-0' resources/views/components/reading-progress.blade.php` returns 1
`grep -c 'bg-rose-pine-pine' resources/views/components/reading-progress.blade.php` returns >= 1
`grep -c 'x-data.*progress' resources/views/components/reading-progress.blade.php` returns >= 1
  </verify>
  <done>Progress bar appears at top, fills as user scrolls down post.</done>
</task>

<task type="auto">
  <name>Task 2: Create sticky table of contents component</name>
  <files>
    resources/views/components/table-of-contents.blade.php
  </files>
  <action>
    Create `resources/views/components/table-of-contents.blade.php`:

    1. Root `<nav>`:
       ```blade
       <nav class="sticky top-24 max-h-[calc(100vh-6rem)] overflow-y-auto">
       ```

    2. Header:
       ```blade
       <h3 class="text-xs font-bold text-rose-pine-muted uppercase tracking-wider mb-3">
           On this page
       </h3>
       ```

    3. List with indentation:
       ```blade
       <ul class="space-y-2 text-sm">
           @foreach($headings as $heading)
               <li class="pl-{{ ($heading->level - 1) * 4 }}">
                   <a href="#{{ $heading->id }}"
                      class="block text-rose-pine-subtle hover:text-rose-pine-text transition-colors">
                       {{ $heading->text }}
                   </a>
               </li>
           @endforeach
       </ul>
       ```

    4. Mobile: Hide on screens smaller than `lg`.
  </action>
  <verify>
`grep -c 'sticky top-24' resources/views/components/table-of-contents.blade.php` returns 1
`grep -c 'text-rose-pine' resources/views/components/table-of-contents.blade.php` returns >= 3
`grep -c 'overflow-y-auto' resources/views/components/table-of-contents.blade.php` returns 1
  </verify>
  <done>Sticky TOC renders on left, shows headings, smooth-scrolls to sections.</done>
</task>

<task type="auto">
  <name>Task 3: Create code block component with copy button and line numbers</name>
  <files>
    resources/views/components/code-block.blade.php
  </files>
  <action>
    Create `resources/views/components/code-block.blade.php`:

    1. Wrapper:
       ```blade
       <div class="relative group my-6 rounded-lg overflow-hidden">
       ```

    2. Header:
       ```blade
       <div class="flex justify-between items-center px-4 py-2 bg-rose-pine-surface border-b border-rose-pine-overlay">
           <span class="text-xs font-mono text-rose-pine-muted">{{ $language }}</span>
           
           <button x-data="{ copied: false }"
                   @click="navigator.clipboard.writeText($refs.code.textContent); copied = true; setTimeout(() => copied = false, 2000)"
                   class="text-xs text-rose-pine-subtle hover:text-rose-pine-text transition-colors">
               <span x-show="!copied">Copy</span>
               <span x-show="copied" class="text-rose-pine-pine">Copied!</span>
           </button>
       </div>
       ```

    3. Code block:
       ```blade
       <pre class="rounded-t-none overflow-x-auto p-4 bg-rose-pine-overlay">
           <code x-ref="code">{!! $highlighted !!}</code>
       </pre>
       ```

    4. Line numbers via CSS:
       ```css
       .shiki { counter-reset: line; }
       .shiki span.c-line::before { counter-increment: line; content: counter(line); margin-right: 1em; }
       ```
  </action>
  <verify>
`grep -c 'bg-rose-pine-surface' resources/views/components/code-block.blade.php` returns >= 1
`grep -c 'bg-rose-pine-overlay' resources/views/components/code-block.blade.php` returns >= 1
`grep -c 'navigator.clipboard' resources/views/components/code-block.blade.php` returns >= 1
  </verify>
  <done>Code blocks have header with language and working copy-to-clipboard button.</done>
</task>

<task type="auto">
  <name>Task 4: Create single blog post view</name>
  <files>
    resources/views/posts/show.blade.php
  </files>
  <action>
    Create `resources/views/posts/show.blade.php`:

    1. Layout:
       ```blade
       @extends('layouts.app')
       @section('content')
       <div class="max-w-4xl mx-auto px-4 py-12">
           <div class="lg:grid lg:grid-cols-4 lg:gap-8">
               {{-- TOC on left (hidden on mobile) --}}
               <aside class="hidden lg:block lg:col-span-1">
                   @if(isset($headings) && count($headings))
                       @include('components.table-of-contents')
                   @endif
               </aside>

               {{-- Main content --}}
               <article class="lg:col-span-3">
                   @include('components.reading-progress')
                   {{-- Post content --}}
               </article>
           </div>
       </div>
       @endsection
       ```

    2. Post header: Title, date, tags

    3. Content: Render markdown with ShikiHighlighter

    4. Rose Pine styling throughout
  </action>
  <verify>
`grep -c 'extends.*layouts.app' resources/views/posts/show.blade.php` returns 1
`grep -c 'lg:grid-cols-4' resources/views/posts/show.blade.php` returns >= 1
`grep -c 'table-of-contents' resources/views/posts/show.blade.php` returns >= 1
`grep -c 'reading-progress' resources/views/posts/show.blade.php` returns >= 1
  </verify>
  <done>Single post renders with title, metadata, TOC, progress bar, and formatted content.</done>
</task>

</tasks>

<verification>
- Visit a blog post, verify progress bar at top fills on scroll
- Verify sticky TOC on left shows all headings
- Click TOC heading, verify smooth scroll to section
- Check code blocks have syntax highlighting
- Verify code blocks have copy button that works
- Verify line numbers display correctly
- Test mobile: TOC should be hidden
</verification>

<success_criteria>
- Single post view renders correctly with all elements
- Syntax highlighting works on code blocks
- Reading progress bar updates on scroll
- Sticky TOC shows headings and scrolls to sections
- Code blocks have copy button functionality
- Mobile layout hides TOC appropriately
</success_criteria>

<output>
After completion, create `.planning/phases/03-blog-features-and-seo/03-04-SUMMARY.md`
