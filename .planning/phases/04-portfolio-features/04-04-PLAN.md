---
phase: 04-portfolio-features
plan: 04
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - app/Http/Controllers/ContactController.php
  - app/Http/Requests/ContactFormRequest.php
  - app/Mail/ContactFormSubmitted.php
  - resources/views/contact/form.blade.php
  - resources/views/contact/thank-you.blade.php
  - resources/views/emails/contact-form.blade.php
  - routes/web.php
autonomous: true

must_haves:
  truths:
    - "Visitor can view a contact form at /contact with name, email, subject, and message fields"
    - "Submitting a valid form saves the submission to the database and sends an email notification"
    - "Client-side validation provides instant feedback on required fields"
    - "Server-side validation rejects invalid email or missing required fields"
    - "Successful submission redirects to a dedicated /contact/thank-you page"
    - "Invalid submission redisplays form with errors and old input preserved"
  artifacts:
    - path: "app/Http/Controllers/ContactController.php"
      provides: "Contact form display and submission handling"
      exports: ["ContactController"]
    - path: "app/Http/Requests/ContactFormRequest.php"
      provides: "Server-side validation rules"
      exports: ["ContactFormRequest"]
    - path: "app/Mail/ContactFormSubmitted.php"
      provides: "Email notification mailable"
      exports: ["ContactFormSubmitted"]
    - path: "resources/views/contact/form.blade.php"
      provides: "Contact form view"
      contains: "form"
    - path: "resources/views/contact/thank-you.blade.php"
      provides: "Thank you page"
      contains: "thank"
    - path: "resources/views/emails/contact-form.blade.php"
      provides: "Email template"
      contains: "message"
  key_links:
    - from: "app/Http/Controllers/ContactController.php"
      to: "app/Models/ContactSubmission.php"
      via: "Eloquent create"
      pattern: "ContactSubmission::create"
    - from: "app/Http/Controllers/ContactController.php"
      to: "app/Mail/ContactFormSubmitted.php"
      via: "Mail facade"
      pattern: "Mail::to"
    - from: "routes/web.php"
      to: "app/Http/Controllers/ContactController.php"
      via: "route registration"
      pattern: "ContactController"
    - from: "resources/views/contact/form.blade.php"
      to: "app/Http/Requests/ContactFormRequest.php"
      via: "POST form submission"
      pattern: "method.*POST"
---

<objective>
Build the contact form with server-side and client-side validation, database persistence, and email notification on submission.

Purpose: Allow visitors to send messages directly through the site. Submissions are saved to the contact_submissions table (created in Plan 01) for tracking, and an email notification is sent to the site owner for immediate awareness.

Output: ContactController with show/store actions, form request validator, Mailable for email notification, contact form view, thank-you page, and email template.
</objective>

<execution_context>
@/home/human/.claude/get-shit-done/workflows/execute-plan.md
@/home/human/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-portfolio-features/04-CONTEXT.md
@.planning/phases/04-portfolio-features/04-01-SUMMARY.md

@app/Http/Controllers/BlogController.php
@app/Models/ContactSubmission.php
@resources/views/layouts/app.blade.php
@resources/css/app.css
@routes/web.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ContactFormRequest, ContactFormSubmitted mailable, and email template</name>
  <files>
    app/Http/Requests/ContactFormRequest.php
    app/Mail/ContactFormSubmitted.php
    resources/views/emails/contact-form.blade.php
  </files>
  <action>
    Create ContactFormRequest form request class:
    - authorize() returns true (public form, no auth required)
    - rules():
      - name: required, string, max:255
      - email: required, email:rfc,dns, max:255
      - subject: nullable, string, max:255
      - message: required, string, min:10, max:5000
    - messages() with user-friendly error text:
      - name.required: 'Please enter your name.'
      - email.required: 'Please enter your email address.'
      - email.email: 'Please enter a valid email address.'
      - message.required: 'Please enter a message.'
      - message.min: 'Your message must be at least 10 characters.'

    Create ContactFormSubmitted mailable (use `php artisan make:mail ContactFormSubmitted` as starting point, then modify):
    - Accept ContactSubmission $submission in constructor
    - Envelope: subject "New Contact Form Submission from {name}", from config('mail.from.address')
    - Content: view 'emails.contact-form', pass $submission
    - Use Queueable trait (implements ShouldQueue) so sending doesn't block the response

    Create email template at resources/views/emails/contact-form.blade.php:
    - Simple, clean HTML email (NOT using Blade component layout -- plain HTML for email compatibility)
    - Show: name, email, subject (if provided), message, submitted at timestamp
    - Include a "Reply to" note with the sender's email address
    - Basic inline CSS for readability (no Tailwind -- emails need inline styles)
    - Keep it minimal: white background, dark text, clear hierarchy
  </action>
  <verify>
    Run `php artisan test` to confirm no syntax errors or regressions.
    Run `php artisan tinker --execute="new \App\Http\Requests\ContactFormRequest();"` to confirm class loads.
    Run `php artisan tinker --execute="new \App\Mail\ContactFormSubmitted(new \App\Models\ContactSubmission(['name'=>'Test','email'=>'test@test.com','message'=>'Test msg']));"` to confirm mailable instantiates.
  </verify>
  <done>
    ContactFormRequest validates name (required), email (required, valid format), subject (optional), message (required, min 10 chars).
    ContactFormSubmitted mailable accepts ContactSubmission and renders email template.
    Email template displays submission details in clean HTML.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ContactController, form view, thank-you page, and routes</name>
  <files>
    app/Http/Controllers/ContactController.php
    resources/views/contact/form.blade.php
    resources/views/contact/thank-you.blade.php
    routes/web.php
  </files>
  <action>
    Create ContactController:
    - show(): View
      - SEO data: title "Contact", description "Get in touch..."
      - Return view('contact.form', compact('seo'))
    - store(ContactFormRequest $request): RedirectResponse
      - Create ContactSubmission::create() with validated data plus ip_address from $request->ip() and user_agent from $request->userAgent()
      - Send email notification: Mail::to(config('mail.from.address'))->send(new ContactFormSubmitted($submission))
        - Use the site owner's configured email as the recipient
        - Set replyTo on the mailable to the submitter's email so owner can reply directly
      - Redirect to route('contact.thank-you') with session flash 'success'

    Create contact/form.blade.php:
    - Extends layouts.app
    - Max width container (max-w-2xl mx-auto px-4 py-12) -- narrower than blog for focused form experience
    - Page heading: "Get In Touch" (text-3xl font-bold text-rose-pine-text)
    - Subtitle: brief encouraging text (text-rose-pine-subtle)
    - Form with POST to route('contact.store'), @csrf
    - Client-side validation using HTML5 required attribute and Alpine.js:
      - Use x-data="{ submitting: false }" on form
      - Submit button shows "Sending..." with submitting state and disabled attribute
      - @submit handler sets submitting = true
    - Form fields with Rose Pine styling:
      - Each field wrapped in div with label (text-sm font-medium text-rose-pine-text mb-1)
      - Input styling: w-full px-4 py-2 rounded-lg bg-rose-pine-surface border border-rose-pine-overlay text-rose-pine-text placeholder-rose-pine-muted focus:outline-none focus:ring-2 focus:ring-rose-pine-iris/50 focus:border-rose-pine-iris
      - Name: text input, required
      - Email: email input, required
      - Subject: text input, optional (label says "Subject (optional)")
      - Message: textarea, required, rows=6
      - Each field shows validation error below in text-sm text-rose-pine-love if @error exists
      - All fields use old() helper to preserve input on validation failure
    - Submit button: w-full bg-rose-pine-iris text-rose-pine-base font-medium py-3 px-6 rounded-lg hover:bg-rose-pine-iris/90 transition disabled:opacity-50 disabled:cursor-not-allowed
    - General error display at top: if $errors->any(), show error summary box (bg-rose-pine-love/10 border border-rose-pine-love/30 text-rose-pine-love rounded-lg p-4)

    Create contact/thank-you.blade.php:
    - Extends layouts.app
    - Centered content (max-w-lg mx-auto px-4 py-24 text-center)
    - SEO data with noindex (no need to index thank-you pages)
    - Large checkmark icon (SVG, text-rose-pine-foam w-16 h-16 mx-auto)
    - "Thank You!" heading (text-3xl font-bold text-rose-pine-text mt-6)
    - Confirmation message (text-rose-pine-subtle mt-4)
    - "Back to Home" link button (inline-block mt-8 bg-rose-pine-iris text-rose-pine-base px-6 py-3 rounded-lg)
    - Only accessible if coming from form submission (controller redirects here); direct visit still works (shows generic thank-you)

    Add routes to web.php in the "Portfolio Routes" comment block (after project routes, before feed routes):
    - GET /contact -> ContactController@show, name 'contact.show'
    - POST /contact -> ContactController@store, name 'contact.store'
    - GET /contact/thank-you -> ContactController@thankYou (add this simple method that returns view), name 'contact.thank-you'

    Do NOT modify existing routes. Append the contact routes alongside the project and about routes.
  </action>
  <verify>
    Run `php artisan route:list --name=contact` to confirm all 3 routes registered.
    Run `php artisan view:cache` to confirm views compile, then `php artisan view:clear`.
    Visit http://localhost:8000/contact to confirm form renders.
    Submit form with empty fields to confirm validation errors display.
    Submit form with valid data to confirm redirect to /contact/thank-you.
    Check database: `php artisan tinker --execute="\App\Models\ContactSubmission::count();"` shows submission saved.
  </verify>
  <done>
    /contact displays a styled contact form with name, email, subject, and message fields.
    Client-side validation uses HTML5 required attributes and Alpine.js loading state.
    Server-side validation rejects invalid data and redisplays form with errors and preserved input.
    Valid submission saves to contact_submissions table with IP and user agent.
    Email notification is queued to site owner with reply-to set to submitter's email.
    /contact/thank-you shows confirmation page after successful submission.
  </done>
</task>

</tasks>

<verification>
- `php artisan route:list --name=contact` shows GET /contact, POST /contact, GET /contact/thank-you
- `php artisan view:cache` compiles all contact views without errors
- /contact form validates required fields (client-side and server-side)
- Successful submission saves to database and triggers email
- /contact/thank-you displays confirmation
</verification>

<success_criteria>
- Contact form has all 4 fields: name (required), email (required), subject (optional), message (required)
- Both client-side (HTML5 + Alpine.js) and server-side (FormRequest) validation
- ContactSubmission saved with ip_address and user_agent
- Email notification sent via ContactFormSubmitted mailable
- Redirect to dedicated /contact/thank-you page after success
- Form preserves old input and displays per-field errors on validation failure
- All views use Rose Pine theme styling consistent with blog
</success_criteria>

<output>
After completion, create `.planning/phases/04-portfolio-features/04-04-SUMMARY.md`
</output>
